version: '3.7'
services:
  database:
    image: 'mysql:latest'
    restart: unless-stopped
    volumes:
      - './database:/var/lib/mysql'
    environment:
      MYSQL_USER: root
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: chronoclash_db
    ports:
      # To allow the host machine to access the ports below, modify the lines below.
      # For example, to allow the host to connect to port 3306 on the container, you would change
      # "3306" to "3306:3306". Where the first port is exposed to the host and the second is the container port.
      # See https://docs.docker.com/compose/compose-file/compose-file-v3/#ports for more information.
      - '3308:3308'
  chronoclash_api:
    depends_on:
      - database
    build: .
    restart: on-failure
    ports:
      - '8081:8081'
    environment:
      SPRING_APPLICATION_JSON: '{
          "spring.datasource.url"  : "jdbc:mysql://database:3308/chronoclash_db",
          "spring.datasource.username" : root,
          "spring.datasource.password" : password,
          "spring.jpa.properties.hibernate.dialect" : "org.hibernate.dialect.MySQL5InnoDBDialect",
          "spring.jpa.hibernate.ddl-auto" : "update"
        }'
    volumes:
      - .m2:/root/.m2